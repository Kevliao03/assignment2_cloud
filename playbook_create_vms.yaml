---
- name: Provision a Chameleon Cloud VM
  hosts: localhost
  connection: local
  vars_files:
    - variables.yaml
  tasks:
    - name: Create a new VM instance
      os_server:
        state: present
        auth:
          project_name: "CH-822922"
          auth_url: https://kvm.tacc.chameleoncloud.org:5000/v3
          project_domain_name: chameleon
        name: "{{ instance_name }}"
        flavor: "{{ flavor }}"
        image: "{{ image }}"
        key_name: "{{ keypair }}"
        network: "{{ network }}"
        auto_ip: yes
      register: vm

    - name: Display VM info
      debug:
        var: vm
